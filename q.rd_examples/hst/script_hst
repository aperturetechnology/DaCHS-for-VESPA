#!/bin/bash
# original query in requete_TAP_systsol.asc
# to be ran from cadc directory, requires a /data subdirectory
# rm data/*.csv 	## pas sur le Mac !!!
mv data/TableHST_CADC.csv data/TableHST_CADC.old  # keep previous version just in case
wget -O data/TableHST_CADC.csv "http://www.cadc-ccda.hia-iha.nrc-cnrc.gc.ca/tap/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT Observation.observationURI AS Preview,   Observation.collection AS Collection,   Observation.observationID AS Obs_ID,   Plane.productID AS Product_ID,   COORD1(CENTROID(Plane.position_bounds)) AS RA,   COORD2(CENTROID(Plane.position_bounds)) AS Dec,   Plane.time_bounds_lower AS Start_Date,   Observation.instrument_name AS Instrument,   Plane.time_exposure AS Int_Time,   Observation.target_name AS Target_Name,   Plane.energy_bandpassName AS Filter,   Plane.calibrationLevel AS Cal_Lev,   Observation.type AS Obs_Type,   Plane.energy_bounds_lower AS Min_Wavelength,   Plane.energy_bounds_upper AS Max_Wavelength,   Observation.proposal_id AS Proposal_ID,   Observation.proposal_pi AS PI_Name,   Plane.dataRelease AS Data_Release,   AREA(Plane.position_bounds) AS Field_of_View,   Plane.position_bounds AS Polygon,   Plane.time_bounds_upper AS End_Date,   Plane.dataProductType AS Data_Type,   Observation.target_keywords AS Target_Keywords,   Observation.metaRelease AS Meta_Release,   Observation.algorithm_name AS Algorithm_Name,   Observation.proposal_title AS Proposal_Title,   Observation.instrument_keywords AS Instrument_Keywords,   Plane.energy_emBand AS Band,   Plane.provenance_producer AS Prov_Producer FROM caom2.Plane AS Plane   JOIN caom2.Observation AS Observation ON Plane.obsID = Observation.obsID  WHERE  ( lower(Observation.intent) = 'science'  AND Observation.collection='HST'  AND  lower(Observation.target_keywords) LIKE '%solar system%' AND  NOT (lower(Observation.target_keywords) LIKE '%asteroid%' AND NOT ( (lower(Observation.target_name) LIKE 'ceres%') or (lower(Observation.target_name) = '1-ceres') or (lower(Observation.target_name) LIKE '%haumea%') or (lower(Observation.target_name) LIKE 'kbo-2005-fy9%') or (lower(Observation.target_name) LIKE 'kbo2005fy9%') or (lower(Observation.target_name) LIKE '2003ub313%') or (lower(Observation.target_keywords) LIKE '%dwarf planet%')) ) AND NOT (lower(Observation.target_keywords) LIKE '%comet%' OR lower(Observation.target_keywords) LIKE '%other%' OR lower(Observation.target_keywords) LIKE '%blank field%') AND  NOT (lower(Observation.target_name) LIKE '%k31114a%' OR lower(Observation.target_name) LIKE '%kbo-g1%' OR lower(Observation.target_name) = '1996rr20' OR lower(Observation.target_name) LIKE '%k14od3s%' OR lower(Observation.target_name) LIKE '%k14p70n%') AND (Plane.calibrationLevel='2' OR Plane.calibrationLevel='3' ) AND  ( Plane.quality_flag IS NULL OR Plane.quality_flag!='junk' ) ) &FORMAT=CSV" 
sudo gavo imp q.rd 
